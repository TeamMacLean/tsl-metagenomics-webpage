<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>background-metadata</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="01-background-metadata_files/libs/clipboard/clipboard.min.js"></script>
<script src="01-background-metadata_files/libs/quarto-html/quarto.js"></script>
<script src="01-background-metadata_files/libs/quarto-html/popper.min.js"></script>
<script src="01-background-metadata_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="01-background-metadata_files/libs/quarto-html/anchor.min.js"></script>
<link href="01-background-metadata_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="01-background-metadata_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="01-background-metadata_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="01-background-metadata_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="01-background-metadata_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="sec-starting-a-metagenomics-project" class="level1">
<h1>Starting a Metagenomics Project</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
⏳ Time
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Teaching: 15 min</li>
<li>Exercises: 15 min</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Questions
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>How do you plan a metagenomics experiment?</li>
<li>What does a metagenomics project look like?</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Learn the differences between shotgun and metabarcoding (amplicon metagenomics) techniques.</li>
<li>Understand the importance of metadata</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Keypoints
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Shotgun metagenomics can be used for taxonomic and functional studies.</li>
<li>Metabarcoding can be used for taxonomic studies.</li>
<li>Collecting metadata beforehand is fundamental for downstream analysis.</li>
</ul>
</div>
</div>
<section id="metagenomics" class="level2">
<h2 class="anchored" data-anchor-id="metagenomics">Metagenomics</h2>
<p>Metagenomes are collections of genomic sequences from various (micro)organisms that coexist in any given space. They are like snapshots that can give us information about the taxonomic and even metabolic or functional composition of the communities we decide to study. Thus, metagenomes are usually employed to investigate the ecology of defining characteristics of niches (* e.g.,*, the human gut or the ocean floor).</p>
<p>Since metagenomes are mixtures of sequences that belong to different species, a metagenomic workflow is designed to answer two questions:</p>
<ol type="1">
<li><p>What species are represented in the sample?</p></li>
<li><p>What are they capable of doing?</p></li>
</ol>
<p>To find which species are present in a niche, we must do a taxonomic assignation of the obtained sequences. To find out their capabilities, we can look at the genes directly encoded in the metagenome or find the genes associated with the species that we found. In order to know which methodology we should use, it is essential to know what questions we want to answer.</p>
</section>
<section id="shotgun-and-amplicon" class="level2">
<h2 class="anchored" data-anchor-id="shotgun-and-amplicon">Shotgun and amplicon</h2>
<p>There are two paths to obtain information from a complex sample:</p>
<ol type="1">
<li><p><strong>Shotgun Metagenomics</strong></p></li>
<li><p><strong>Metabarcoding</strong>.</p></li>
</ol>
<p>Each is named after the sequencing methodology employed Moreover, have particular use cases with inherent advantages and disadvantages.</p>
<p>With <strong>Shotgun Metagenomics</strong>, we sequence random parts (ideally all of them) of the genomes present in a sample. We can search the origin of these pieces (<em>i.e.,</em> their taxonomy) and also try to find to what part of the genome they correspond. Given enough pieces, it is possible to obtain complete individual genomes from a shotgun metagenome (MAGs), which could give us a bunch of information about the species in our study. MAGs assembly, however, requires a lot of genomic sequences from one organism. Since the sequencing is done at random, it needs a high depth of community sequencing to ensure that we obtain enough pieces of a given genome. Required depth gets exponentially challenging when our species of interest is not very abundant. It also requires that we have enough DNA to work with, which can be challenging to obtain in some instances. Finally, sequencing is expensive, and because of this, making technical and biological replicates can be prohibitively costly.</p>
<p>On the contrary, <strong>Metabarcoding</strong> tends to be cheaper, which makes it easier to duplicate and even triplicate them without taking a big financial hit. The lower cost is because Metabarcoding is the collection of small genomic fragments present in the community and amplified through PCR. Ideally, if the amplified region is present only once in every genome, we would not need to sequence the amplicon metagenome so thoroughly because one sequence is all we need to get the information about that genome, and by extension, about that species. On the other hand, if a genome in the community lacks the region targeted by the PCR primers, then no amount of sequencing can give us information about that genome. Conservation across species is why the most popular amplicon used for this methodology are 16S amplicons for Bacteria since every known bacterium has this particular region. Other regions can be chosen, but they are used for specific cases. However, even 16S amplicons are limited to, well, the 16S region, so amplicon metagenomes cannot directly tell us a lot about the metabolic functions found in each genome, although educated guesses can be made by knowing which genes are commonly found in every identified species.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig/01-01.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Overview of Metagenomics Workflow</figcaption>
</figure>
</div>
</section>
<section id="on-metadata" class="level2">
<h2 class="anchored" data-anchor-id="on-metadata">On Metadata</h2>
<p>Once we have chosen an adequate methodology for our study, we must take extensive notes on the origin of our samples and how we treated them. These notes constitute the <strong>metadata</strong>, or data about our data, and they are crucial to understanding and interpreting the results we will obtain later in our metagenomic analysis. Most of the time, the differences that we observe when comparing metagenomes can be correlated to the metadata, which is why we must devote a whole section of our experimental design to the metadata we expect to collect and record carefully.</p>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Discussion #1: Choosing amplicon or shotgun sequencing?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suppose you want to find the source of a nasty gut infection in people. Which type of sequencing methodology would you choose?<br>
Which type of metadata would be helpful to record?</p>
</div>
</div>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>For a first exploration, 16S is a better idea since you could detect known pathogens by knowing the taxons in the community. Nevertheless, if the disease is the consequence of a viral infection, the pathogen can only be discovered with shotgun metagenomics (that was the case of SARS-CoV 2). Also, metabarcoding does not provide insights into the genetic basis of the pathogenic phenotypes. Metadata will depend on the type of experiment. For this case, some helpful metadata could be sampling methodology, date, place (country, state, region, city, etc.), patient’s sex and age, the anatomical origin of the sample, symptoms, medical history, diet, lifestyle, and environment.</p>
</div>
</div>
</div>
</section>
<section id="our-dataset---microbiome-of-healthy-and-diseased-chilli-peppers" class="level2">
<h2 class="anchored" data-anchor-id="our-dataset---microbiome-of-healthy-and-diseased-chilli-peppers">Our Dataset - Microbiome of Healthy and Diseased Chilli Peppers</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig/01-02.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Gao et al.&nbsp;Microbiome (2021) 9:187</figcaption>
</figure>
</div>
<p>The data we will use during this workshop comes from a study examining the microbiome of healthy and diseased chilli peppers <a href="https://microbiomejournal.biomedcentral.com/articles/10.1186/s40168-021-01138-2">Gao et al.&nbsp;Microbiome (2021) 9:187</a>.</p>
<p>The disease causing organism of interest was <em>Fusarium oxysporum</em> f.&nbsp;sp. <em>capsici</em>, which causes <em>Fusarium</em> wild disease (FWD) in chilli peppers. The study examined the recruitment of protective microbes to suppress pathogen growth during FWD infection. They researchers hypothesised that infection would more severely impact vegetative organs (the root, stem and leaves), rather than reproductive (the fruit, flower and seed). They also predicted that fungal communities would be more sensitive to FWD than bacterial, as fungal communities are more responsive to vegetative change than bacterial. Finally, they surmised that functional differences would occur between the healthy and diseased plants.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig/01-03.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Overview of sampling sites</figcaption>
</figure>
</div>
<p>Plant samples were obtained from chilli pepper production fields, divided into healthy (those plants showing no disease and testing pathogen-negative) and diseased (those that showed wilt symptoms and tested pathogen-positive). Each plant sample was divided into 12 compartments: the bulk soil (BulkS), rhizosphere soil (RHS), root episphere (Repi) and endosphere (Rendo), bottom stem epidermis (BS-epidermis) and xylem (BS-xylem), middle stem epidermis (MS-epidermis) and xylem (MS-xylem), upper stem epidermis (US-epidermis) and xylem (US-xylem), and fruit episphere (Fepi) and endophere (Fendo).</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 1: Reviewing metadata
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>From the hypothesises outlined, what kind of sequencing method do you think they used?</p>
<ol type="A">
<li>Metabarcoding</li>
<li>Shotgun Metagenomics</li>
<li>Genomics of pure cultures</li>
</ol></li>
<li><p>In the table <a href="https://github.com/TeamMacLean/tsl-metagenomics-analysis-workshop/files/PRJNA667299_metadata_truncated.csv">sample metadata</a> what is the most important piece of metadata collected?</p></li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>A) Metabarcoding. True. This technique would allow them to get an overview of the microorganisms associated with each compartment, for each condition.
B) Shotgun Metagenomics. True. Only shotgun metagenomics would allow for functional characterisation.
C) Genomics of pure cultures. False. Information on the microbial community cannot be fully obtained with pure cultures.</code></pre>
<p>The most crucial thing to know about our data is whether our sample comes from healthy or diseased plants, then which compartment the sample came from.<br>
However, any differences in the technical parts of the study, such as the DNA extraction protocol, could have affected the results, so tracking those is also essential.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 2: Differentiate between IDs and sample names
</div>
</div>
<div class="callout-body-container callout-body">
<p>Depending on the database, several IDs can be used for the same sample. Please open the document where the <a href="https://github.com/TeamMacLean/tsl-metagenomics-analysis-workshop/files/PRJNA667299_metadata_truncated.csv">sample metadata information is stored</a>. Here, inspect the Run IDs and find out which of them correspond to sample <strong>F_Sample_116</strong></p>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>SRR12773203 is the SRA run ID that corresponds to sample F_Sample_116</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 3: Discuss the importance of metadata
</div>
</div>
<div class="callout-body-container callout-body">
<p>Which other information could you recommend to add in the metadata?</p>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Metadata will depend on the type of the experiment, but some examples are the properties of the water before and after fertilization, sampling, and processing methodology, date and time, place (country, state, region, city, etc.).</p>
</div>
</div>
</div>
<p>Throughout the lesson, we will be using samples from upper stem epidermis (US-epidermis), from healthy or diseased plants. The IDs and samples are below:</p>
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 26%">
<col style="width: 32%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>SRA Accession</th>
<th>Sample Name</th>
<th>Plant Condition</th>
<th>Sequencing Method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SRR12773249</td>
<td>B_Sample_98</td>
<td>Healthy</td>
<td>Metabarcoding</td>
</tr>
<tr class="even">
<td>SRR12773081</td>
<td>F_Sample_98</td>
<td>Healthy</td>
<td>Metabarcoding</td>
</tr>
<tr class="odd">
<td>SRR12778015</td>
<td>Sample_98</td>
<td>Healthy</td>
<td>Shotgun Metagenomics</td>
</tr>
<tr class="even">
<td>SRR12773380</td>
<td>B_Sample_108</td>
<td>Diseased</td>
<td>Metabarcoding</td>
</tr>
<tr class="odd">
<td>SRR12773212</td>
<td>F_Sample_108</td>
<td>Diseased</td>
<td>Metabarcoding</td>
</tr>
<tr class="even">
<td>SRR12778021</td>
<td>Sample_108</td>
<td>Diseased</td>
<td>Shotgun Metagenomics</td>
</tr>
</tbody>
</table>
<p>The results of this study, raw sequences, and metadata have been submitted to the NCBI Sequence Read Archive (SRA) and stored in the BioProject <a href="https://www.ncbi.nlm.nih.gov/bioproject/PRJNA667562">PRJNA667562</a>.</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Other Metagenomic Databases
</div>
</div>
<div class="callout-body-container callout-body">
<p>The NCBI SRA is not the only repository for metagenomic information. There are other public metagenomic databases such as <a href="https://www.mg-rast.org/index.html?stay=1">MG-RAST</a>, <a href="https://www.ebi.ac.uk/metagenomics/">MGnify</a>, <a href="https://mmp.sfb.uit.no/">Marine Metagenomics Portal</a>, <a href="https://webapp.ufz.de/tmdb/">Terrestrial Metagenome DB</a> and the <a href="https://gmrepo.humangut.info/home">GM Repo</a>.</p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>